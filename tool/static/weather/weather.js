var description = {
  0: {
    day: {
      description: "Sunny",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/clear-day.svg",
    },
    night: {
      description: "Clear",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/clear-night.svg",
    },
  },
  1: {
    day: {
      description: "Mainly Sunny",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/partly-cloudy-day.svg",
    },
    night: {
      description: "Mainly Clear",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/partly-cloudy-night.svg",
    },
  },
  2: {
    day: {
      description: "Partly Cloudy",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/partly-cloudy-day.svg",
    },
    night: {
      description: "Partly Cloudy",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/partly-cloudy-night.svg",
    },
  },
  3: {
    day: {
      description: "Cloudy",
      image: "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/cloudy.svg",
    },
    night: {
      description: "Cloudy",
      image: "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/cloudy.svg",
    },
  },
  45: {
    day: {
      description: "Foggy",
      image: "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/fog-day.svg",
    },
    night: {
      description: "Foggy",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/fog-night.svg",
    },
  },
  48: {
    day: {
      description: "Rime Fog",
      image: "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/fog.svg",
    },
    night: {
      description: "Rime Fog",
      image: "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/fog.svg",
    },
  },
  51: {
    day: {
      description: "Light Drizzle",
      image: "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/drizzle.svg",
    },
    night: {
      description: "Light Drizzle",
      image: "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/drizzle.svg",
    },
  },
  53: {
    day: {
      description: "Drizzle",
      image: "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/rain.svg",
    },
    night: {
      description: "Drizzle",
      image: "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/rain.svg",
    },
  },
  55: {
    day: {
      description: "Heavy Drizzle",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/overcast-day-drizzle.svg",
    },
    night: {
      description: "Heavy Drizzle",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/overcast-night-drizzle.svg",
    },
  },
  56: {
    day: {
      description: "Light Freezing Drizzle",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/partly-cloudy-day-sleet.svg",
    },
    night: {
      description: "Light Freezing Drizzle",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/partly-cloudy-night-sleet.svg",
    },
  },
  57: {
    day: {
      description: "Freezing Drizzle",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/overcast-day-sleet.svg",
    },
    night: {
      description: "Freezing Drizzle",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/overcast-night-sleet.svg",
    },
  },
  61: {
    day: {
      description: "Light Rain",
      image: "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/rain.svg",
    },
    night: {
      description: "Light Rain",
      image: "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/rain.svg",
    },
  },
  63: {
    day: {
      description: "Rain",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/overcast-rain.svg",
    },
    night: {
      description: "Rain",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/overcast-rain.svg",
    },
  },
  65: {
    day: {
      description: "Heavy Rain",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/extreme-rain.svg",
    },
    night: {
      description: "Heavy Rain",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/extreme-rain.svg",
    },
  },
  66: {
    day: {
      description: "Light Freezing Rain",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/partly-cloudy-day-sleet.svg",
    },
    night: {
      description: "Light Freezing Rain",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/partly-cloudy-night-sleet.svg",
    },
  },
  67: {
    day: {
      description: "Freezing Rain",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/overcast-day-sleet.svg",
    },
    night: {
      description: "Freezing Rain",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/overcast-night-sleet.svg",
    },
  },
  71: {
    day: {
      description: "Light Snow",
      image: "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/snow.svg",
    },
    night: {
      description: "Light Snow",
      image: "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/snow.svg",
    },
  },
  73: {
    day: {
      description: "Snow",
      image: "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/snow.svg",
    },
    night: {
      description: "Snow",
      image: "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/snow.svg",
    },
  },
  75: {
    day: {
      description: "Heavy Snow",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/snowflake.svg",
    },
    night: {
      description: "Heavy Snow",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/snowflake.svg",
    },
  },
  77: {
    day: {
      description: "Snow Grains",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/extreme-day-snow.svg",
    },
    night: {
      description: "Snow Grains",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/extreme-night-snow.svg",
    },
  },
  80: {
    day: {
      description: "Light Showers",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/partly-cloudy-day-drizzle.svg",
    },
    night: {
      description: "Light Showers",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/partly-cloudy-night-drizzle.svg",
    },
  },
  81: {
    day: {
      description: "Showers",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/partly-cloudy-day-rain.svg",
    },
    night: {
      description: "Showers",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/partly-cloudy-night-rain.svg",
    },
  },
  82: {
    day: {
      description: "Heavy Showers",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/extreme-day-rain.svg",
    },
    night: {
      description: "Heavy Showers",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/extreme-night-rain.svg",
    },
  },
  85: {
    day: {
      description: "Light Snow Showers",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/overcast-day-sleet.svg",
    },
    night: {
      description: "Light Snow Showers",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/overcast-night-sleet.svg",
    },
  },
  86: {
    day: {
      description: "Snow Showers",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/overcast-day-sleet.svg",
    },
    night: {
      description: "Snow Showers",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/overcast-night-sleet.svg",
    },
  },
  95: {
    day: {
      description: "Thunderstorm",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/thunderstorms.svg",
    },
    night: {
      description: "Thunderstorm",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/thunderstorms.svg",
    },
  },
  96: {
    day: {
      description: "Thunderstorm With Hail",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/thunderstorms-snow.svg",
    },
    night: {
      description: "Thunderstorm With Hail",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/thunderstorms-snow.svg",
    },
  },
  99: {
    day: {
      description: "Thunderstorm With Hail",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/thunderstorms-snow.svg",
    },
    night: {
      description: "Thunderstorm With Hail",
      image:
        "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/thunderstorm-snow.svg",
    },
  },
};
var todo = 0,
  completed = 0;
function showContent() {
  document.querySelector(".weather-content").style.display = "";
  document.querySelector(".loading-view").style.display = "none";
}
function hideContent() {
  document.querySelector(".weather-content").style.display = "none";
  document.querySelector(".loading-view").style.display = "";
}
function matchWeatherIcons(id) {
  var baseURL = "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/";
  if (id == 50) return baseURL + "clear-day.svg";
  if (id == 51) return baseURL + "partly-cloudy-day.svg";
  if (id == 52) return baseURL + "partly-cloudy-day.svg";
  if (id == 53) return baseURL + "partly-cloudy-day-rain.svg";
  if (id == 54) return baseURL + "overcast-day-drizzle.svg";
  if (id == 60) return baseURL + "cloudy.svg";
  if (id == 61) return baseURL + "overcast.svg";
  if (id == 62) return baseURL + "overcast-drizzle.svg";
  if (id == 63) return baseURL + "extreme-rain.svg";
  if (id == 64) return baseURL + "thunderstorms-extreme-rain.svg";
  if (id == 70) return baseURL + "moon-new.svg";
  if (id == 71) return baseURL + "moon-waxing-crescent.svg";
  if (id == 72) return baseURL + "moon-waxing-gibbous.svg";
  if (id == 73) return baseURL + "moon-full.svg";
  if (id == 74) return baseURL + "moon-waning-gibbous.svg";
  if (id == 75) return baseURL + "moon-waning-crescent.svg";
  if (id == 76) return baseURL + "overcast-night.svg";
  if (id == 77) return baseURL + "partly-cloudy-night.svg";
  if (id == 80) return baseURL + "wind.svg";
  if (id == 81)
    return baseURL + "https://www.hko.gov.hk/images/HKOWxIconOutline/pic81.png";
  if (id == 82)
    return baseURL + "https://www.hko.gov.hk/images/HKOWxIconOutline/pic82.png";
  if (id == 83) return baseURL + "fog.svg";
  if (id == 84) return baseURL + "mist.svg";
  if (id == 85) return baseURL + "mist.svg";
  if (id == 90) return baseURL + "thermometer-sun.svg";
  if (id == 91) return baseURL + "thermometer-warmer.svg";
  if (id == 92) return baseURL + "thermometer-colder.svg";
  if (id == 93) return baseURL + "thermometer-snow.svg";
}
function getWeatherCaption(id) {
  if (id == 50) return "Sunny";
  if (id == 51) return "Sunny Periods";
  if (id == 52) return "Sunny Intervals";
  if (id == 53) return "Sunny Periods with A Few Showers";
  if (id == 54) return "Sunny Intervals with Showers";
  if (id == 60) return "Cloudy";
  if (id == 61) return "Overcast";
  if (id == 62) return "Light Rain";
  if (id == 63) return "Rain";
  if (id == 64) return "Heavy Rain";
  if (id == 65) return "Thunderstorms";
  if (id == 70) return "Fine";
  if (id == 71) return "Fine";
  if (id == 72) return "Fine";
  if (id == 73) return "Fine";
  if (id == 74) return "Fine";
  if (id == 75) return "Fine";
  if (id == 76) return "Mainly Cloudy";
  if (id == 77) return "Mainly Fine";
  if (id == 80) return "Windy";
  if (id == 81) return "Dry";
  if (id == 82) return "Humid";
  if (id == 83) return "Fog";
  if (id == 84) return "Mist";
  if (id == 85) return "Haze";
  if (id == 90) return "Hot";
  if (id == 91) return "Warm";
  if (id == 92) return "Cool";
  if (id == 93) return "Cold";
}
function matchTimeIcons(hr) {
  var baseURL = "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/";
  if (0 <= hr && hr <= 2) return baseURL + "time-night.svg";
  if (3 <= hr && hr <= 5) return baseURL + "time-late-night.svg";
  if (6 <= hr && hr <= 8) return baseURL + "time-morning.svg";
  if (9 <= hr && hr <= 11) return baseURL + "time-late-morning.svg";
  if (12 <= hr && hr <= 14) return baseURL + "time-afternoon.svg";
  if (15 <= hr && hr <= 17) return baseURL + "time-late-afternoon.svg";
  if (18 <= hr && hr <= 20) return baseURL + "time-evening.svg";
  if (21 <= hr && hr <= 24) return baseURL + "time-late-evening.svg";
  return undefined;
}
function searchZone(dt) {
  for (let i = 0; i < dt.length; i++) if (dt[i].place == "Sha Tin") return i;
}
function convertWindDirection(dg) {
  if ((348.75 < dg && dg <= 360) || (0 <= dg && dg <= 11.25)) return "N";
  if (11.25 < dg && dg <= 33.75) return "NNE";
  if (33.75 < dg && dg <= 56.25) return "NE";
  if (56.25 < dg && dg <= 78.75) return "ENE";
  if (78.75 < dg && dg <= 101.25) return "E";
  if (101.25 < dg && dg <= 123.75) return "ESE";
  if (123.75 < dg && dg <= 146.25) return "SE";
  if (146.25 < dg && dg <= 168.75) return "SSE";
  if (168.75 < dg && dg <= 191.25) return "S";
  if (191.25 < dg && dg <= 213.75) return "SSW";
  if (213.75 < dg && dg <= 236.25) return "SW";
  if (236.25 < dg && dg <= 258.75) return "WSW";
  if (258.75 < dg && dg <= 281.25) return "W";
  if (281.25 < dg && dg <= 303.75) return "WNW";
  if (303.75 < dg && dg <= 326.25) return "NW";
  if (326.75 < dg && dg <= 348.75) return "NNW";
}
const months = [
  "Jan",
  "Feb",
  "Mar",
  "Apr",
  "May",
  "Jun",
  "Jul",
  "Aug",
  "Sep",
  "Oct",
  "Nov",
  "Dec",
];
const weekdays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
async function getAPI() {
  hideContent();
  date = new Date();
  date.toLocaleTimeString("zh-hk", { hour12: false });
  response = await fetch(
    "https://data.weather.gov.hk/weatherAPI/opendata/weather.php?dataType=flw&lang=en"
  );
  var data = await response.json();
  $(".currentWeatherSituation").html(
    data.generalSituation + "\n" + data.outlook
  );
  response = await fetch(
    "https://data.weather.gov.hk/weatherAPI/opendata/weather.php?dataType=fnd&lang=en"
  );
  var data = await response.json();
  for (let i = 1; i <= 5; i++) {
    $(".Day" + i.toString()).html(
      "<strong>" + weekdays[(date.getDay() + i) % 7].toString() + "</strong>"
    );
    document.querySelector(".Day" + i.toString() + "Icon").src =
      matchWeatherIcons(data.weatherForecast[i].ForecastIcon);
    $(".temperatureDay" + i.toString()).html(
      data.weatherForecast[i].forecastMintemp.value.toString() +
        "°C - " +
        data.weatherForecast[i].forecastMaxtemp.value.toString() +
        "°C"
    );
  }
  $(".currentDeltaTemperature").html(
    data.weatherForecast[0].forecastMintemp.value.toString() +
      "°C - " +
      data.weatherForecast[0].forecastMaxtemp.value.toString() +
      "°C"
  );
  response = await fetch(
    "https://data.weather.gov.hk/weatherAPI/opendata/weather.php?dataType=rhrread&lang=en"
  );
  var data = await response.json();
  $(".currentTemperature").html(
    data.temperature.data[searchZone(data.temperature.data)].value.toString() +
      "°C"
  );
  $(".currentPositionnDatetime").html(
    data.temperature.data[searchZone(data.temperature.data)].place +
      ", " +
      months[date.getMonth()] +
      " " +
      date.getDate() +
      " " +
      (date.getHours() < 10 ? "0" : "") +
      date.getHours().toString() +
      ":" +
      (date.getMinutes() < 10 ? "0" : "") +
      date.getMinutes().toString()
  );
  document.querySelector(".currentWeatherIcon").src = matchWeatherIcons(
    data.icon[0]
  );
  $(".currentWeatherInfo").html(getWeatherCaption(data.icon[0]));
  $(".currentHumidity").html(data.humidity.data[0].value + "%");
  $(".currentRainfall").html(
    data.rainfall.data[searchZone(data.rainfall.data)].max +
      " " +
      data.rainfall.data[searchZone(data.rainfall.data)].unit
  );
  document.querySelector(".currentUVLevelIcon").src =
    "https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/uv-index" +
    (data.uvindex == "" ? "" : "-" + data.uvindex.data[0].value) +
    ".svg";

  $(".currentUVLevel").html(
    data.uvindex == "" ? "0" : data.uvindex.data[0].value
  );
  response = await fetch(
    "https://api.open-meteo.com/v1/forecast?latitude=22.2783&longitude=114.1747&hourly=temperature_2m,weathercode,windspeed_10m,winddirection_10m&daily=weathercode&timezone=Asia%2FSingapore"
  );
  var data = await response.json();
  $(".currentWindSpeed").html(
    data.hourly.windspeed_10m[date.getHours()] +
      " km/h, " +
      convertWindDirection(data.hourly.winddirection_10m[date.getHours()])
  );
  for (let i = 1; i <= 5; i++) {
    $(".temperatureTime" + i.toString()).html(
      data.hourly.temperature_2m[date.getHours() + i - 1] + "°C"
    );
    $(".Time" + i.toString()).html(
      "<strong>" +
        (((date.getHours() + i - 1) % 24 < 10 ? "0" : "") +
          ((date.getHours() + i - 1) % 24).toString() +
          ":00") +
        "</strong>"
    );
    if (
      6 <= (date.getHours() + i - 1) % 24 &&
      (date.getHours() + i - 1) % 24 <= 17
    )
      document.querySelector(".Time" + i.toString() + "Icon").src =
        description[data.hourly.weathercode[date.getHours() + i - 1]].day.image;
    else
      document.querySelector(".Time" + i.toString() + "Icon").src =
        description[
          data.hourly.weathercode[date.getHours() + i - 1]
        ].night.image;
  }
  showContent();
}
document.addEventListener("DOMContentLoaded", function () {
  $(".loader").css({
    marginTop:
      (
        ($(document).outerHeight(true) -
          $("nav.navbar").outerHeight(true) -
          $(".body").outerHeight(true) -
          $("footer.footer").outerHeight(true) -
          $(".loader").height()) /
        2
      ).toString() + "px",
  });
  getAPI();
  setInterval(getAPI, 1000 * 60 * 5);
  window.addEventListener("resize", () => {
    $(".loader").css({
      marginTop:
        (
          ($(document).outerHeight(true) -
            $("nav.navbar").outerHeight(true) -
            $(".body").outerHeight(true) -
            $("footer.footer").outerHeight(true) -
            $(".loader").height()) /
          2
        ).toString() + "px",
    });
  });
});
